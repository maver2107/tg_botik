# üî® –ì–∞–π–¥ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –¥–ª—è –¥–∂—É–Ω–∞

## üìã –û–±–∑–æ—Ä –∑–∞–¥–∞—á–∏

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—è `swipe` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–ª–æ—ë–≤.

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** ‚Äî –∫–∞–∂–¥—ã–π —Å–ª–æ–π –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Å–≤–æ—é —á–∞—Å—Ç—å
2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞** ‚Äî DRY –ø—Ä–∏–Ω—Ü–∏–ø
3. **–£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏** ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É

## üèóÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Handler (Controller)          ‚îÇ  ‚Üê –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç Telegram
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö             ‚îÇ  ‚Üê –£–ø—Ä–∞–≤–ª—è–µ—Ç FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
‚îÇ  - –í—ã–∑—ã–≤–∞–µ—Ç Service                     ‚îÇ  ‚Üê –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç Service –∏ Presenter
‚îÇ  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Presenter –¥–ª—è UI          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Service                     ‚îÇ  ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ë–ï–ó UI!)
‚îÇ  - –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç DAO                     ‚îÇ  ‚Üê –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–Ω—ã—Ö –ª–∞–π–∫–æ–≤
‚îÇ  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞             ‚îÇ  ‚Üê –°–æ–∑–¥–∞–Ω–∏–µ –º—ç—Ç—á–µ–π
‚îÇ  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç!)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                DAO                       ‚îÇ  ‚Üê –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ  - –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î —á–µ—Ä–µ–∑ SQLAlchemy        ‚îÇ  ‚Üê –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îÇ  - –°–æ–∑–¥–∞–Ω–∏–µ/—á—Ç–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π   ‚îÇ  ‚Üê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  Presenter (View)       ‚îÇ  ‚Üê UI-–ª–æ–≥–∏–∫–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ Handler)
        ‚îÇ  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ       ‚îÇ  ‚Üê –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
        ‚îÇ  - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram  ‚îÇ  ‚Üê –†–∞–±–æ—Ç–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìù –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω

### –®–∞–≥ 0: –°–æ–∑–¥–∞—Ç—å Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ Service

**–í–ê–ñ–ù–û!** Service –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Pydantic –º–æ–¥–µ–ª–∏, –∞ –Ω–µ dict.

–°–æ–∑–¥–∞–π –º–æ–¥–µ–ª–∏ –≤ `src/bot/models/responses.py`:

```python
from pydantic import BaseModel
from src.bot.models.user import Users

class LikeProcessResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∞–π–∫–∞"""
    model_config = {"arbitrary_types_allowed": True}
    
    is_match: bool
    matched_user: Users | None
    current_user: Users
    next_profile: Users | None

class DislikeProcessResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏–∑–ª–∞–π–∫–∞"""
    model_config = {"arbitrary_types_allowed": True}
    
    next_profile: Users | None

class MatchWithDetails(BaseModel):
    """–ú—ç—Ç—á —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π"""
    model_config = {"arbitrary_types_allowed": True}
    
    user: Users
    match_date: datetime | None = None
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Pydantic –º–æ–¥–µ–ª–µ–π –Ω–∞–¥ dict:**

‚úÖ **–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE:**
- `result.is_match` –≤–º–µ—Å—Ç–æ `result["is_match"]`
- IDE –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤:**
- Mypy/Pyright –Ω–∞—Ö–æ–¥—è—Ç –æ—à–∏–±–∫–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞
- `result.is_match` –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ bool

‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–µ—á–∞—Ç–æ–∫:**
- `result.is_mach` ‚Üí –æ—à–∏–±–∫–∞ —Å—Ä–∞–∑—É
- `result["is_mach"]` ‚Üí KeyError —Ç–æ–ª—å–∫–æ –≤ runtime

‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —è–≤–Ω–æ –æ–ø–∏—Å–∞–Ω–∞ –≤ –∫–æ–¥–µ
- –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç–æ–¥

---

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Presenter

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/bot/presenters/swipe.py`:

```python
from aiogram.types import Message, CallbackQuery
from src.bot.models.user import Users
from src.bot.keyboards.swipe import get_swipe_keyboard

class SwipePresenter:
    """–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫—É UI"""
    
    @staticmethod
    def format_profile(user: Users, hide_name: bool = False) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
        if hide_name:
            return f"üé≠ –ö—Ç–æ-—Ç–æ, {user.age}, {user.city}\n{user.interests}"
        return f"{user.name}, {user.age}, {user.city}\n{user.interests}"
    
    @staticmethod
    async def send_profile(
        target: Message | CallbackQuery, 
        profile: Users, 
        hide_name: bool = False,
        state_context = None
    ):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–Ω–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        profile_text = SwipePresenter.format_profile(profile, hide_name)
        keyboard = get_swipe_keyboard(profile.tg_id)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
        if isinstance(target, CallbackQuery):
            message = target.message
        else:
            message = target
            
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å —Ñ–æ—Ç–æ –∏–ª–∏ –±–µ–∑
        if profile.photo_id:
            await message.answer_photo(
                photo=profile.photo_id,
                caption=profile_text,
                reply_markup=keyboard
            )
        else:
            await message.answer(profile_text, reply_markup=keyboard)
    
    @staticmethod
    def format_match_message(matched_user: Users) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –º—ç—Ç—á–µ"""
        username = f"@{matched_user.username}" if matched_user.username else "–±–µ–∑ username"
        return (
            f"üî• –í–∑–∞–∏–º–Ω–∞—è —Å–∏–º–ø–∞—Ç–∏—è!\n\n"
            f"–í—ã –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –¥—Ä—É–≥ –¥—Ä—É–≥—É!\n"
            f"–ö–æ–Ω—Ç–∞–∫—Ç: {username}\n\n"
            f"–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ! üí¨"
        )
    
    @staticmethod
    def format_like_notification() -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ '–¢—ã –∫–æ–º—É-—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è'"""
        return "‚ù§Ô∏è –¢—ã –∫–æ–º—É-—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è!\n\n–ü–æ–∫–∞–∑–∞—Ç—å –∫—Ç–æ —ç—Ç–æ?"
    
    @staticmethod
    async def send_no_profiles_message(target: Message | CallbackQuery):
        """–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –∞–Ω–∫–µ—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å"""
        text = "üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–Ω–∫–µ—Ç –ø–æ–∫–∞ –Ω–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ!"
        if isinstance(target, CallbackQuery):
            await target.message.answer(text)
        else:
            await target.answer(text)
```

### –®–∞–≥ 2: –†–∞—Å—à–∏—Ä–∏—Ç—å DAO

–î–æ–±–∞–≤—å –º–µ—Ç–æ–¥—ã –≤ `src/bot/dao/user.py`:

```python
async def get_next_profile(
    self, 
    user_id: int, 
    excluded_ids: list[int], 
    gender_filter: Gender | None
) -> Optional[Users]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–∫–µ—Ç—É —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏"""
    # –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–∑ SwipeService.get_next_profile
    pass

async def get_profiles_by_ids(self, user_ids: list[int]) -> list[Users]:
    """–ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ ID"""
    pass
```

–î–æ–±–∞–≤—å –≤ `src/bot/dao/like.py`:

```python
async def get_rated_user_ids(self, user_id: int) -> list[int]:
    """–ü–æ–ª—É—á–∏—Ç—å ID –≤—Å–µ—Ö –æ—Ü–µ–Ω—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    pass

async def get_users_who_liked_me(self, user_id: int) -> list[int]:
    """–ü–æ–ª—É—á–∏—Ç—å ID —Ç–µ—Ö, –∫—Ç–æ –ª–∞–π–∫–Ω—É–ª –º–µ–Ω—è"""
    pass

async def get_unrated_from_list(
    self, 
    user_id: int, 
    candidate_ids: list[int]
) -> list[int]:
    """–ò–∑ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤–µ—Ä–Ω—É—Ç—å —Ç–µ—Ö, –∫–æ–≥–æ –µ—â—ë –Ω–µ –æ—Ü–µ–Ω–∏–ª"""
    pass
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å Service

–ü–µ—Ä–µ–¥–µ–ª–∞–π `src/bot/services/swipe.py`:

```python
from src.bot.models.responses import LikeProcessResult, DislikeProcessResult, MatchWithDetails

class SwipeService:
    """–ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–µ–∑ UI"""
    
    async def get_next_profile(self, user_id: int) -> Optional[Users]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–∫–µ—Ç—É"""
        # 1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        current_user = await self.users_dao.get_by_tg_id(user_id)
        if not current_user:
            return None
            
        # 2. –ü–æ–ª—É—á–∏—Ç—å —É–∂–µ –æ—Ü–µ–Ω—ë–Ω–Ω—ã—Ö
        rated_ids = await self.likes_dao.get_rated_user_ids(user_id)
        
        # 3. –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∫–µ—Ç—É —Å —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
        return await self.users_dao.get_next_profile(
            user_id=user_id,
            excluded_ids=rated_ids,
            gender_filter=current_user.gender_interest
        )
    
    async def get_profiles_who_liked_me(self, user_id: int) -> list[Users]:
        """–ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∫–µ—Ç—ã —Ç–µ—Ö, –∫—Ç–æ –ª–∞–π–∫–Ω—É–ª –º–µ–Ω—è"""
        # 1. –ö—Ç–æ –ª–∞–π–∫–Ω—É–ª
        liked_me_ids = await self.likes_dao.get_users_who_liked_me(user_id)
        if not liked_me_ids:
            return []
            
        # 2. –ö–æ–≥–æ —è –µ—â—ë –Ω–µ –æ—Ü–µ–Ω–∏–ª
        not_rated = await self.likes_dao.get_unrated_from_list(
            user_id, liked_me_ids
        )
        if not not_rated:
            return []
            
        # 3. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏
        return await self.users_dao.get_profiles_by_ids(not_rated)
    
    async def process_like(
        self, 
        from_user_id: int, 
        to_user_id: int
    ) -> LikeProcessResult:  # ‚úÖ Pydantic –º–æ–¥–µ–ª—å –≤–º–µ—Å—Ç–æ dict!
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ª–∞–π–∫ –ë–ï–ó –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        
        Returns:
            LikeProcessResult —Å –ø–æ–ª—è–º–∏:
            - is_match: bool
            - matched_user: Users | None
            - current_user: Users
            - next_profile: Users | None
        """
        # –î–æ–±–∞–≤–ª—è–µ–º –ª–∞–π–∫
        await self.likes_dao.add_like(from_user_id, to_user_id, is_like=True)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∑–∞–∏–º–Ω–æ—Å—Ç—å
        is_match = await self.likes_dao.check_mutual_like(from_user_id, to_user_id)
        
        matched_user = None
        current_user = await self.users_dao.get_by_tg_id(from_user_id)
        
        if is_match:
            await self.matches_dao.create_match(from_user_id, to_user_id)
            matched_user = await self.users_dao.get_by_tg_id(to_user_id)
        
        next_profile = await self.get_next_profile(from_user_id)
        
        # ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º Pydantic –º–æ–¥–µ–ª—å
        return LikeProcessResult(
            is_match=is_match,
            matched_user=matched_user,
            current_user=current_user,
            next_profile=next_profile
        )
    
    async def process_dislike(
        self,
        from_user_id: int,
        to_user_id: int
    ) -> DislikeProcessResult:  # ‚úÖ Pydantic –º–æ–¥–µ–ª—å
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∏–∑–ª–∞–π–∫"""
        await self.likes_dao.add_like(from_user_id, to_user_id, is_like=False)
        next_profile = await self.get_next_profile(from_user_id)
        
        return DislikeProcessResult(next_profile=next_profile)
    
    async def get_user_matches_with_details(
        self, 
        user_id: int
    ) -> list[MatchWithDetails]:  # ‚úÖ Pydantic –º–æ–¥–µ–ª—å
        """–ü–æ–ª—É—á–∏—Ç—å –º—ç—Ç—á–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
        matches = await self.matches_dao.get_user_matches(user_id)
        result = []
        
        for match in matches:
            other_id = match.user2_id if match.user1_id == user_id else match.user1_id
            other_user = await self.users_dao.get_by_tg_id(other_id)
            if other_user:
                result.append(
                    MatchWithDetails(
                        user=other_user,
                        match_date=match.created_at
                    )
                )
        
        return result
```

### –®–∞–≥ 4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å Handler

–ü–µ—Ä–µ–¥–µ–ª–∞–π `src/bot/handlers/swipe.py`:

```python
from src.bot.presenters.swipe import SwipePresenter

@swipe_router.message(Command("search"))
async def start_search(
    message: Message, 
    swipe_service: SwipeService,
    presenter: SwipePresenter,
    state: FSMContext
):
    """–ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∫–µ—Ç"""
    user_id = message.from_user.id
    next_profile = await swipe_service.get_next_profile(user_id)
    
    if not next_profile:
        await presenter.send_no_profiles_message(message)
        return
    
    await state.set_state(SwipeStates.normal_browsing)
    await presenter.send_profile(message, next_profile)


@swipe_router.callback_query(F.data.startswith("like_"))
async def process_like_callback(
    callback: CallbackQuery,
    swipe_service: SwipeService,
    presenter: SwipePresenter,
    state: FSMContext,
    bot: Bot
):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∞–π–∫–∞"""
    to_user_id = int(callback.data.split("_")[1])
    from_user_id = callback.from_user.id
    
    await callback.message.edit_reply_markup(reply_markup=None)
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    current_state = await state.get_state()
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ª–∞–π–∫ (–ë–ï–ó –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
    result = await swipe_service.process_like(from_user_id, to_user_id)
    
    # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º Pydantic –º–æ–¥–µ–ª—å - –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
    # result.is_match –≤–º–µ—Å—Ç–æ result["is_match"]
    if result.is_match:
        match_text = presenter.format_match_message(result.matched_user)
        await callback.message.answer(match_text)
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await bot.send_message(
            to_user_id,
            presenter.format_match_message(result.current_user)
        )
    else:
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–∞–π–∫–µ
        from src.bot.keyboards.swipe import get_show_likes_keyboard
        await bot.send_message(
            to_user_id,
            presenter.format_like_notification(),
            reply_markup=get_show_likes_keyboard()
        )
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–∫–µ—Ç—É
    if current_state == SwipeStates.viewing_likes:
        profiles = await swipe_service.get_profiles_who_liked_me(from_user_id)
        next_profile = profiles[0] if profiles else result.next_profile  # ‚úÖ .next_profile
        hide_name = bool(profiles)
    else:
        next_profile = result.next_profile  # ‚úÖ .next_profile
        hide_name = False
    
    if not next_profile:
        await callback.message.answer("üòî –ê–Ω–∫–µ—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!")
        await state.clear()
        await callback.answer()
        return
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–∫–µ—Ç—É
    await presenter.send_profile(callback, next_profile, hide_name)
    await callback.answer("‚ù§Ô∏è –õ–∞–π–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")


@swipe_router.message(Command("matches"))
async def show_matches(
    message: Message,
    swipe_service: SwipeService,
    presenter: SwipePresenter
):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º—ç—Ç—á–∏"""
    user_id = message.from_user.id
    matches = await swipe_service.get_user_matches_with_details(user_id)
    
    if not matches:
        await message.answer("–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –º—ç—Ç—á–µ–π üòî")
        return
    
    # ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Presenter + –∏—Å–ø–æ–ª—å–∑—É–µ–º Pydantic –º–æ–¥–µ–ª–∏
    matches_text = "üíï –¢–≤–æ–∏ –º—ç—Ç—á–∏:\n\n"
    for match_data in matches:  # match_data —ç—Ç–æ MatchWithDetails
        user = match_data.user  # ‚úÖ .user –≤–º–µ—Å—Ç–æ ["user"]
        username = f"@{user.username}" if user.username else "–±–µ–∑ username"
        matches_text += f"‚Ä¢ {user.name} - {username}\n"
    
    await message.answer(matches_text)
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/presenters/swipe.py` —Å –∫–ª–∞—Å—Å–æ–º `SwipePresenter`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- [ ] –ò–∑ `SwipeService` —É–¥–∞–ª—ë–Ω –∏–º–ø–æ—Ä—Ç `get_show_likes_keyboard`
- [ ] –ò–∑ `SwipeService` —É–¥–∞–ª—ë–Ω –º–µ—Ç–æ–¥ `format_profile`
- [ ] –ò–∑ `SwipeService.process_like` —É–¥–∞–ª—ë–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `bot`
- [ ] –ò–∑ `SwipeService` —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ `bot.send_message()`
- [ ] –ò–∑ Handler —É–¥–∞–ª–µ–Ω—ã –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ DAO (`matches_dao`, `users_dao`)
- [ ] –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∫–µ—Ç
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω –ª–∏–Ω—Ç–µ—Ä–æ–º

## üéì –ß—Ç–æ —Ç—ã –∏–∑—É—á–∏—à—å

1. **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** ‚Äî Single Responsibility, Dependency Inversion
2. **Layered Architecture** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏
3. **Separation of Concerns** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
4. **DRY** ‚Äî Don't Repeat Yourself
5. **Clean Code** ‚Äî —á–∏—Ç–∞–µ–º—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Clean Architecture by Uncle Bob](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [SOLID Principles](https://www.digitalocean.com/community/conceptual-articles/s-o-l-i-d-the-first-five-principles-of-object-oriented-design)
- [MVC/MVP/MVVM patterns](https://medium.com/@ankit.sinhal/mvc-mvp-and-mvvm-design-pattern-6e169567bbad)

---

**–£–¥–∞—á–∏! üöÄ –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –∏–∑—É—á–∞–π TODO-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ!**

